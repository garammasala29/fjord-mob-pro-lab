## 概要
簡単なインタプリタをRubyで作ろう！

## 実行方法
CLIのエントリポイントは`bin/repl.rb`にあります。

```bash
ruby ./bin/repl.rb
```

## 実装方法
`lib/parser_step(n).rb` にそれぞれのステップのロジックを記述してください。 実装が完了したら、対応するテストを実行して確認します。

### テストの実行方法

```bash
# 全テストを実行
bundle exec rspec

# 例: step1 のテストを個別に実行
bundle exec rspec spec/parser_step1_spec.rb
```

## 各ステップの概要

### Step1
2項の値(整数)と1つの演算子(operator)を受け取り評価するインタプリタの実装を行なってください。

演算子の種類は`+, -, *, /`の4つを想定していますが、別に増やしてもらって構いません。
`/`演算子の挙動に関してはRubyの`/`と同じにしてください。(つまり小数点以下切り捨て)

例)

```rb
# OK
1 + 3
#=> 4

# OK
5 / 2
#=> 2

# NG
1 + 3 - 4 # 3項の演算

# NG
1.3 * 2.4 # 小数を含む演算(できるが正しい値は出ない)
```

### Step2
左から順番に評価するようにして、3項以上の式（例: `"1 + 2 * 3"`）を左結合で処理できるようにします。

※このステップでは演算の優先順位は考慮しません。

例)
```rb
ParserStep2.eval("2 + 3 * 4") #=> 20 (2 + 3 = 5, 5 * 4 = 20)
ParserStep2.eval("10 - 2 + 1") #=> 9
```

### Step3
演算子の優先順位（`*`, `/`が`+`, `-`より先）を考慮した評価を行えるようにします。
このステップでも全ての演算子は左結合として扱います。

例)
```rb
ParserStep3.eval("2 + 3 * 4") #=> 14 (3 * 4 = 12, 2 + 12 = 14)
ParserStep3.eval("45 / 5 / 3") #=> 3 (45 / 5 = 9, 9 / 3 = 3)
ParserStep3.eval("10 - 4 / 2 + 3") #=> 11 (4 / 2 = 2, 10 - 2 = 8, 8 + 3 = 11)
```

### Step4
このステップでは2つの大きな変更を行います：

1. **括弧のサポート**: 式の中で括弧 `( )` をサポートして、優先順位を動的に変更できるようにします。括弧で囲まれた部分は、最も高い優先順位として扱われます。

2. **評価器の分離**: 構文解析（パース）と評価を明確に分離します。パーサーは抽象構文木（AST）を返し、エバリュエーターがそのASTを評価します。これにより、コードの責務が明確に分離され、拡張性が向上します。

### 文法規則

基本的な文法規則は以下のようになります：

```txt
expression → term (('+' | '-') term)*
term       → factor (('*' | '/') factor)*
factor     → integer | '(' expression ')'
```

#### アーキテクチャ
- **Parser**: 入力文字列をASTに変換
  - `ParserStep4.parse(input)`→ASTを返す
- **Evaluator**: ASTを評価して結果を計算
  - `Evaluator.evaluate(ast)`→計算結果を返す

#### 使用例
例)
```rb
ast = ParserStep4.parse("2 * (3 + 4)")
result = Evaluator.new.evaluate(ast)  # => 14

ast = ParserStep4.parse("(3 + 4) * 2")
result = Evaluator.new.evaluate(ast)  # => 14

ast = ParserStep4.parse("10 - (4 + 2) * 3")
result = Evaluator.new.evaluate(ast)  # => -8
```

#### やること
実装のポイント

- パーサーの factor メソッドを拡張して、括弧内の式を expression として再帰的に解析
- 抽象構文木（AST）を実装して、式の構造を表現
- 評価ロジックをパーサーから分離して、専用のエバリュエーターに移動
- REPL（対話型実行環境）を更新して、パースと評価の分離を反映


### 今後
:TODO: さらに途中
- Step5: 小数や変数の導入
- Step6: 関数の導入（再帰含む）
